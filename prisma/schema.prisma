generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int          @id @default(autoincrement())
  email         String       @unique
  password      String
  firstName     String?
  lastName      String?
  company       String?
  jobTitle      String?
  phone         String?
  timezone      String?
  
  // Additional profile fields
  gender        String?
  age           Int?
  highestDegree String?
  mainGoal      String?
  hasCoach      Boolean?
  employeeCount String?
  
  // User type and plan
  userType      UserType     @default(individual)
  plan          PlanType     @default(starter)
  billingCycle  BillingCycle @default(monthly)
  
  // Stripe integration
  stripeCustomerId     String?
  stripeSubscriptionId String?
  
  // Account status
  isActive      Boolean      @default(true)
  emailVerified Boolean      @default(false)
  
  // Timestamps
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  
  // Relations
  subscription  Subscription?
  assessments   AssessmentResult[]
  evaluators    Evaluator[]
}

model Subscription {
  id              Int          @id @default(autoincrement())
  userId          Int          @unique
  user            User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  plan            PlanType     @default(starter)
  billingCycle    BillingCycle @default(monthly)
  status          SubscriptionStatus @default(active)
  
  // Pricing
  price           Int          @default(0)
  currency        String       @default("USD")
  
  // Dates
  startDate       DateTime     @default(now())
  endDate         DateTime?
  nextBillingDate DateTime?
  cancelledAt     DateTime?
  
  // Features
  hasCoaching     Boolean      @default(false)
  coachingSessions Int         @default(0)
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
}

enum UserType {
  individual
  coach
  business
}

enum PlanType {
  starter
  individual
  coach
  professional
  enterprise
  revelation
  coaching
}

enum BillingCycle {
  monthly
  annual
}

enum SubscriptionStatus {
  active
  cancelled
  expired
  pending
}

// Assessment Results
model AssessmentResult {
  id              Int              @id @default(autoincrement())
  userId          Int
  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  assessmentType  AssessmentType
  answers         Json             // Store all answers as JSON
  scores          Json             // Store calculated scores as JSON
  dominantResult  String?          // e.g., "ENFJ" for MBTI, "Collaborating" for TKI
  overallScore    Int?             // Percentage score (0-100)
  
  completedAt     DateTime         @default(now())
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  
  @@unique([userId, assessmentType])
  @@index([userId])
}

enum AssessmentType {
  tki
  wellness
  self_360
  mbti
}

// 360Â° Feedback Evaluators
model Evaluator {
  id              Int              @id @default(autoincrement())
  userId          Int
  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Evaluator info
  name            String
  email           String
  relationship    EvaluatorRelationship
  
  // Invitation tracking
  token           String           @unique @default(uuid())
  status          EvaluatorStatus  @default(pending)
  
  // Email tracking
  inviteSentAt    DateTime?
  reminderSentAt  DateTime?
  
  // Feedback
  feedbackAnswers Json?            // Store feedback answers as JSON
  feedbackScores  Json?            // Store calculated scores as JSON
  completedAt     DateTime?
  
  // Timestamps
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  
  @@unique([userId, email])
  @@index([userId])
  @@index([token])
}

enum EvaluatorRelationship {
  manager
  peer
  direct_report
  other
}

enum EvaluatorStatus {
  pending
  invited
  started
  completed
}
